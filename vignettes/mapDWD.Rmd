---
title: "DWD weather stations"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{mapDWD}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

[rdwd main vignette](rdwd.html)

The `rdwd` package provides a collection of all the metafiles on the 
[DWD data server](ftp://ftp-cdc.dwd.de/pub/CDC/observations_germany/climate).
It is presented as an interactive map below.

The first line of the info box (when you click on a point)
can be copypasted into R to obtain more information on the available files.

```{r map, fig.height=7, fig.width=7, warning=FALSE}
library(rdwd)  ;  data(geoIndex)  ;  library(leaflet) 
leaflet(geoIndex) %>% addTiles() %>%
        addCircles(~long, ~lat, radius=900, stroke=F, color=~col)%>%
        addCircleMarkers(~long, ~lat, popup=~display, stroke=F, color=~col)
```

Open this vignette locally for faster reaction times than on the CRAN html view:
```{r vignette_local, eval=FALSE}
vignette("mapdwd")
```




The blue dots mark stations for which recent files are available 
(with >=1 file in 'recent' folder or 'BIS_DATUM' later than one year ago).
The red dots mark all stations with only historical datasets.

To see only the stations with recent data, copypaste the following code:

```{r onlyrecent, eval=FALSE}
library(rdwd)  ;  library(leaflet)
data("geoIndex")
leaflet(data=geoIndex[geoIndex$recentfile,]) %>% addTiles() %>%
        addCircleMarkers(~long, ~lat, popup=~display, stroke=F)
```

Many stations have slightly different coordinates, depending on the description metadata file.
They may have been corrected over time, station locations may have actually changed, 
or different variables may be measured at different locations.

All station IDs where the coordinates are no further than 900 m apart (the fix circle radius)
are aggregated and plotted in the position where most datasets are available.
For aggregated stations, the popup infobox `nfiles_coord` entry contains more than one value.

To see every location on the map, copypaste the following code:

```{r all, eval=FALSE}
data("geoIndexAll")
leaflet(data=geoIndexAll) %>% addTiles() %>%
        addCircleMarkers(~long, ~lat, popup=~display, stroke=F)
```

Map created in last section of [meta.R](https://github.com/brry/rdwd/blob/master/R/meta.R#L303).
